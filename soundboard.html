<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Soundboard</title>
  <script src="./jquery-v3.4.1.min.js"></script>
  <script type="text/javascript">
    var sound_definitions = [
      {
        'name': 'arrow-hit-dirt',
        'audio': [
          './effects/arrow-hit-dirt-1.ogg',
          './effects/arrow-hit-dirt-2.ogg',
          './effects/arrow-hit-dirt-3.ogg',
          './effects/arrow-hit-dirt-4.ogg',
        ],
      },
      './effects/arrow-hit-wood-1.ogg',
      './effects/arrow-miss-1.ogg',
      './effects/bludgeon-hit-flesh-groan-1.ogg',
      './effects/bludgeon-hit-flesh-groan-2.ogg',
      './effects/bludgeon-hit-metal-2.ogg',
      './effects/bludgeon-hit-metal.ogg',
      './effects/bow-loose-arrow-hit-wood.ogg',
      {
        'name': 'clang',
        'audio': [
          './effects/clang-1.ogg',
          './effects/clang-2.ogg',
          './effects/clang-3.ogg',
          './effects/clang-4.ogg',
          './effects/clang-5.ogg',
          './effects/clang-6.ogg',
          './effects/clang-7.ogg',
        ],
      },
      {
        'name': 'crossbow-load',
        'audio': [
          './effects/crossbow-load-1.ogg',
          './effects/crossbow-load-2.ogg',
          './effects/crossbow-load-3.ogg',
        ],
      },
      './effects/demons-soul-walkthrough.oga',
      './effects/flapping-wings.ogg',
      './effects/groan-1.ogg',
      './effects/monstrous-roar-1.ogg',
      './effects/punch-1.ogg',
      './effects/punch-2.ogg',
      './effects/red-tailed-hawk-scream.ogg',
      {
        'name': 'slap-hit-groan',
        'audio': [
          './effects/slap-hit-groan-1.ogg',
          './effects/slap-hit-groan-2.ogg',
          './effects/slap-hit-groan-3.ogg',
          './effects/slap-hit-groan-4.ogg',
        ],
      },
      {
        'name': 'slash-hit-flesh-groan',
        'audio': [
          './effects/slash-hit-flesh-groan-1.ogg',
          './effects/slash-hit-flesh-groan-2.ogg',
          './effects/slash-hit-flesh-groan-3.ogg',
        ],
      },
      './effects/slash-hit-metal-1.ogg',
      './effects/slash-hit-metal-2.ogg',
      './effects/slice-1.ogg',
      './effects/sword-clang-1.ogg',
      {
        'name': 'sword-clash',
        'audio': [
          './effects/sword-clash-1.ogg',
          './effects/sword-clash-2.ogg',
          './effects/sword-clash-3.ogg',
        ],
      },
      './effects/thunder-clap-2.oga',
      './effects/thunder-clap.oga',
      './effects/whoosh-1.ogg',
      './ambient/battlefield.ogg',
      './ambient/thunderstorm.ogg',
      './music/horizon-zero-dawn-ost-colossal.oga',
      './music/horizon-zero-dawn-ost-frostclaw-battle.ogg',
      './music/skyrim-ost-blood-and-steel.ogg',
      './music/the-go-team-everyones-a-vip-to-someone.oga',
    ];
  </script>
</head>
<body>
  <div id="doc" style="display: grid; grid: auto-flow / repeat(auto-fill, 270px); grid-gap: 10px"></div>
  <script type="text/javascript" charset="utf-8">

    // Go through each sound definition and insert the HTML elements
    // accordingly
    for (var i = 0; i < sound_definitions.length; i += 1) {

      var sound_definition = sound_definitions[i];
      var elem = $(
        '<div class="audio_block" style="width: 270px;"></div>'
      );

      var name = '';
      if (typeof(sound_definition) == 'string') {
        // Definitions that are just strings are assumed to be just the URL for
        // a single audio clip.
        var sound_url = sound_definition;
        var sound_name = sound_url.match(/.+\/(.+)\.\w{3}/)[1];
        elem.append($(
          '<audio src="' + sound_url + '" controls autobuffer="true" title="' + sound_name + '" style="height: 15px;"></audio><br>'
        ));
        name = sound_name;
        elem.append($('<button style="width: 100%;">' + name + '</button><br>'));
        elem.append($('<input class="loop" type="checkbox">loop</input>'));
      } else if (typeof(sound_definition) == 'object') {
        // Definitions that are objects are assumed to be hash objects that
        // have two keys: 'name' and 'audio'. The 'audio' key is expected to be
        // an array of audio clip URLs.
        var sound_urls = sound_definition.audio;
        for (var j = 0; j < sound_urls.length; j += 1) {
          var sound_url = sound_urls[j];
          var sound_name = sound_url.match(/.+\/(.+)\.\w{3}/)[1];
          elem.append($(
            '<audio src="' + sound_url + '" controls autobuffer="true" title="' + sound_name + '" style="height: 15px;"></audio><br>'
          ));
        }
        name = sound_definition.name;
        elem.append($('<button style="width: 100%;">' + name + '</button><br>'));
      }

      $('#doc').append(elem);
    }

    // Do stuff after the document is done loading so that the audio clips are
    // available for referencing
    $(document).ready(function() {

      // Go through each audio block to set up the play button handler to play
      // some random audio in tbe audio block.
      $('.audio_block').each(function(i, audio_block_elem) {
        var audio_block = $(audio_block_elem);
        var all_audio = audio_block.find('audio');
        var audio = audio_block.find('audio')[0];
        var audio_button = audio_block.find('button')[0];
        $(audio_button)
          .click(function() {
            if (audio_block.unplayed_indices === undefined ||
                audio_block.unplayed_indices.length == 0) {
              audio_block.unplayed_indices = Array();
              for (var i = 0; i < all_audio.length; i += 1) {
                audio_block.unplayed_indices.push(i);
              }
            }
            var index_into_unplayed =
              parseInt(Math.random() * audio_block.unplayed_indices.length);
            var index_into_audio =
              audio_block.unplayed_indices.splice(index_into_unplayed, 1)[0];
            var audio = all_audio[index_into_audio];
            audio.currentTime = 0;
            audio.play();
          });

        // If this isn't a group of audio then looping can be controlled using
        // an input checkbox.
        var audio_loop_checkbox = audio_block.find('.loop');
        if (audio_loop_checkbox) {
          audio_loop_checkbox = audio_loop_checkbox[0];
          $(audio_loop_checkbox)
            // If the loop checkbox is changed then we update the audio clip's
            // looping state to match the checkbox state
            .change(function() {
              var checkbox = $(this);
              $(all_audio).each(function (i, x) {
                x.loop = checkbox.prop('checked');
              });
            })
            // Automatically set audio clips that are longer than 60 seconds to
            // loop
            .prop('checked', (audio.loop = (audio.duration >= 60.0)));
        }
      });
    });
  </script>
</body>
</html>
